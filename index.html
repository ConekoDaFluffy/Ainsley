<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div align="center">
    <h1>PIXELKAT BOT</h1>
    <p>Click the generate button to create another message</p>
    <div id="generator">
      <button id="followDevButton" onclick="followDev()">
        <img src="ainsley.png" alt="Ainsley icon"> Follow the dev!
      </button>
      <button id="followPixelkatButton" onclick="followPixelkat()">
        <img src="pixelkat.png" alt="X icon"> Follow Pixelkat!
      </button>
      <p id="output">
        OUTPUT HERE!!
      </p>
      <button id="generateButton" onclick="generateOutput()">
        Generate
      </button>
    </div>
  </div>

  <script>
    function followDev() {
      window.open('https://twitter.com/PixelKat6', '_blank');
    }

    function followPixelkat() {
      window.open('https://twitter.com/ainsley_mainly', '_blank');
    }

    function buildMarkovModel(text, order = 2) {
      const words = text.split(' ');
      const markovModel = {};

      for (let i = 0; i < words.length - order; i++) {
        const prefix = words.slice(i, i + order).join(' ');
        const nextWord = words[i + order];

        if (!markovModel[prefix]) {
          markovModel[prefix] = { words: [], probabilities: [] };
        }

        markovModel[prefix].words.push(nextWord);
      }

      // Calculate probabilities
      Object.keys(markovModel).forEach(prefix => {
        const wordCount = markovModel[prefix].words.length;
        const probabilities = markovModel[prefix].words.reduce((acc, word) => {
          acc[word] = (acc[word] || 0) + 1 / wordCount;
          return acc;
        }, {});
        markovModel[prefix].probabilities = probabilities;
      });

      return markovModel;
    }

    function generateOutput() {
      fetch('db.txt')
        .then(response => response.text())
        .then(textContent => {
          const markovModel = buildMarkovModel(textContent);
          const order = 2; // Change this to the desired order of the Markov model

          // Generate text
          let currentPrefix = Object.keys(markovModel)[Math.floor(Math.random() * Object.keys(markovModel).length)];
          let generatedText = currentPrefix.split(' ');

          while (generatedText.length < 50) {
            if (markovModel[currentPrefix]) {
              const nextWord = selectNextWord(markovModel[currentPrefix].probabilities);
              generatedText.push(nextWord);
              currentPrefix = generatedText.slice(-order).join(' ');
            } else {
              break;
            }
          }

          document.getElementById('output').innerText = generatedText.join(' ');
        })
        .catch(error => console.error('Error loading file:', error));
    }

    function selectNextWord(probabilities) {
      const rand = Math.random();
      let cumulativeProbability = 0;

      for (const [word, probability] of Object.entries(probabilities)) {
        cumulativeProbability += probability;
        if (rand <= cumulativeProbability) {
          return word;
        }
      }

      // Default case (shouldn't happen)
      return '';
    }
  </script>
</body>
</html>
